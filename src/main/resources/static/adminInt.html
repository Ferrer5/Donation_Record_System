<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation Record System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="body1">
  <header class="main-header">
    <div class="logo-title">
      <img src="images/ginatilanlogo1.png" alt="Logo" class="header-logo">
      <h2>Donation Record System</h2>
    </div>
    <div class="settings-container">
      <button class="settings-btn" id="settingsBtn" onclick="toggleSettingsMenu()" title="Settings">
        <span class="settings-icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
      <div class="settings-menu" id="settingsMenu">
        <a href="#" onclick="goToAnnouncement(); return false;">Make Announcement</a>
        <a href="#" onclick="goToViewRecord(); return false;">View Record</a>
        <a href="#" onclick="goToAddRecord(); return false;">Add Record</a>
        <a href="#" onclick="goToMembers(); return false;">Members</a>
        <a href="#" onclick="handleAdminLogout(); return false;">Log Out</a>
      </div>
    </div>
  </header>

  <main class="main-container1">
    <div class="welcome-card" id="welc-card">
      <h1 id="welc">WELCOME!</h1> 
      <p id="welc1">
        Greetings, Admin! Here you can manage all donation records <br>
        and keep track of user activity. Post announcements, stay updated,<br> and 
        ensure everything runs smoothly in your community.
      </p>
      <h1 id="welc4">Pending Donations</h1>
      
      <div class="notifications" id="pendingDonationsContainer">
        <div class="loading-message">Loading pending donations...</div>
      </div>

      <button class="notif-btn" onclick="goToNotif()">
        <img src="images/notif-icon.png" alt="Notifications">
      </button>
    </div>
    
  </main>

  <footer class="main-footer">
    <p>&copy; 2025 Donation Record System | All Rights Reserved</p>
    <p>Developed by CTU Ginatilan Students.</p>
  </footer>

  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      await loadPendingDonations();
    });
    async function loadPendingDonations() {
      const container = document.getElementById('pendingDonationsContainer');
      const donations = await Donation.getPendingDonations();

      if (donations.length === 0) {
        container.innerHTML = '<div class="notif-box"><p>âœ… All caught up! No pending donations at this time.</p></div>';
        return;
      }

      container.innerHTML = donations.map(donation => {
        const amountDisplay = donation.donationType === 'Cash' 
          ? Donation.formatAmount(donation.amount)
          : donation.message ? donation.message.split('\n')[0].replace('Items: ', '') : 'N/A';
        
        return `
          <div class="notif-box" style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <strong>${donation.fullName}</strong>
              <span style="background: #ff7b00; color: #000; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">PENDING</span>
            </div>
            <p><strong>Type:</strong> ${donation.donationType} | <strong>Amount/Items:</strong> ${amountDisplay}</p>
            ${donation.email ? `<p><strong>Email:</strong> ${donation.email}</p>` : ''}
            ${donation.message && donation.donationType !== 'Goods' ? `<p><em>${donation.message}</em></p>` : ''}
            <p><small>Submitted: ${Donation.formatDate(donation.createdAt)}</small></p>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <button class="red-btn" style="padding: 8px 15px; font-size: 0.9rem; flex: 1;" 
                      onclick="approveDonation(${donation.id})">
                Approve
              </button>
              <button class="red-btn" style="padding: 8px 15px; font-size: 0.9rem; flex: 1; background-color: #dc3545;" 
                      onclick="removeDonation(${donation.id}, this)">
                Remove
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function approveDonation(donationId) {
      const success = await Donation.approve(donationId);
      if (success) {
        await loadPendingDonations();
      }
    }
    
    async function removeDonation(donationId, button) {
      if (confirm('Are you sure you want to remove this donation? This action cannot be undone.')) {
        const success = await Donation.remove(donationId);
        if (success) {
          // Remove the donation card from the UI immediately
          const card = button.closest('.notif-box');
          if (card) {
            card.style.opacity = '0';
            setTimeout(() => {
              card.remove();
              // Reload the list to update the UI
              loadPendingDonations();
            }, 300);
          }
        }
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation Record System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="body1">
  <header class="main-header">
    <div class="logo-title">
      <img src="images/ginatilanlogo1.png" alt="Logo" class="header-logo">
      <h2>Donation Record System</h2>
    </div>
    <div class="settings-container">
      <button class="settings-btn" id="settingsBtn" onclick="toggleSettingsMenu()" title="Settings">
        <span class="settings-icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
      <div class="settings-menu" id="settingsMenu">
        <a href="#" onclick="goToViewRecord(); return false;">View Record</a>
        <a href="#" onclick="goToAddRecord(); return false;">Add Record</a>
        <a href="#" onclick="goToMembers(); return false;">Members</a>
        <a href="#" onclick="handleAdminLogout(); return false;">Log Out</a>
      </div>
    </div>
  </header>

  <main class="main-container1">
    <section id="record-container" class="admin-card record-card">
      <div class="record-header">
        <div>
          <p class="eyebrow-text">Administrator Toolkit</p>
          <h1>Add Donation Record</h1>
          <p class="helper-text">Auto-approve trusted entries and keep the dashboard in sync.</p>
        </div>
        <button class="x-btn" onclick="goBack()" aria-label="Close add record view">
          <img src="images/458594.png" alt="Close">
        </button>
      </div>

      <form id="addRecordForm" class="record-form" onsubmit="event.preventDefault(); submitAddRecord();">
        <div class="form-grid">
          <div class="record-field">
            <label for="donorName">Donor's Name</label>
            <input type="text" id="donorName" name="donorName" placeholder="e.g. Maria Santos" required>
          </div>

          <div class="record-field">
            <label for="donorEmail">Donor's Email</label>
            <input type="email" id="donorEmail" name="donorEmail" placeholder="Optional contact">
          </div>

          <div class="record-field">
            <label for="username">Linked Username</label>
            <input type="text" id="username" name="username" placeholder="Existing user account (optional)">
          </div>

          <div class="record-field">
            <label for="donationType">Donation Type</label>
            <select id="donationType" name="donationType" onchange="toggleOtherField()" required>
              <option value="" disabled selected>Select donation type</option>
              <option value="Cash">Cash</option>
              <option value="Goods">Goods</option>
              <option value="Food">Food</option>
              <option value="Others">Others</option>
            </select>
            <input type="text" id="otherDonation" name="otherDonation" class="stacked-input" placeholder="Please specify (e.g., hygiene kits)" style="display:none;">
          </div>

          <div class="record-field amount-field" id="amountField">
            <label for="amount">Amount (â‚±)</label>
            <input type="number" id="amount" name="amount" placeholder="0.00" min="0" step="0.01">
          </div>

          <div class="record-field" id="itemsField" style="display: none;">
            <label for="itemsDescription">Items / Quantity</label>
            <input type="text" id="itemsDescription" name="itemsDescription" placeholder="e.g. 15 relief packs">
          </div>
        </div>

        <div class="record-field full-width">
          <label for="message">Internal Notes</label>
          <textarea id="message" name="message" rows="3" placeholder="Add instructions, recipients, or drop-off details..."></textarea>
        </div>

        <div class="record-footer">
          <button type="submit" id="confirmBtn" class="red-btn">Save Record</button>
        </div>
      </form>
    </section>
  </main>

  <footer class="main-footer">
    <p>&copy; 2025 Donation Record System | All Rights Reserved</p>
    <p>Developed by CTU Ginatilan Students.</p>
  </footer>

  <script src="script.js"></script>
  <script>
    // Toggle fields based on donation type
    function toggleOtherField() {
      const donationType = document.getElementById('donationType').value;
      const otherDonationField = document.getElementById('otherDonation');
      const amountField = document.getElementById('amountField');
      const itemsField = document.getElementById('itemsField');
      const amountInput = document.getElementById('amount');
      const itemsInput = document.getElementById('itemsDescription');
      
      // Reset fields
      if (otherDonationField) otherDonationField.style.display = 'none';
      if (amountField) amountField.style.display = 'block';
      if (itemsField) itemsField.style.display = 'none';
      if (amountInput) amountInput.removeAttribute('required');
      if (itemsInput) itemsInput.removeAttribute('required');
      
      // Clear values when switching
      if (amountInput) amountInput.value = '';
      if (itemsInput) itemsInput.value = '';
      
      if (donationType === 'Others') {
        if (otherDonationField) otherDonationField.style.display = 'block';
        if (otherDonationField) otherDonationField.setAttribute('required', 'required');
      }
      
      if (donationType === 'Cash') {
        if (amountInput) amountInput.setAttribute('required', 'required');
      } else if (donationType === 'Goods') {
        if (amountField) amountField.style.display = 'none';
        if (itemsField) itemsField.style.display = 'block';
        if (itemsInput) itemsInput.setAttribute('required', 'required');
      }
    }

    // Submit add record form
    async function submitAddRecord() {
      const requiredFields = ['donorName', 'donationType'];
      
      if (!FormUtils.validateRequired(requiredFields)) {
        return;
      }

      const donationType = FormUtils.getValue('donationType');
      const amountInput = document.getElementById('amount');
      const itemsInput = document.getElementById('itemsDescription');
      
      // Validate based on donation type
      if (donationType === 'Cash') {
        const amount = FormUtils.getValue('amount');
        if (!amount || parseFloat(amount) <= 0) {
          Toast.error('Please enter a valid donation amount');
          return;
        }
      } else if (donationType === 'Goods') {
        const itemsDescription = FormUtils.getValue('itemsDescription');
        if (!itemsDescription || itemsDescription.trim() === '') {
          Toast.error('Please enter the number of items');
          return;
        }
      }

      const donorName = FormUtils.getValue('donorName');
      const email = FormUtils.getValue('donorEmail');
      const username = FormUtils.getValue('username');
      const amount = donationType === 'Cash' ? parseFloat(FormUtils.getValue('amount')) : 0;
      const itemsDescription = FormUtils.getValue('itemsDescription');
      const message = FormUtils.getValue('message');
      const otherDonation = FormUtils.getValue('otherDonation');

      try {
        const data = await API.post('/donations/admin/add', {
          donorName: donorName,
          email: email || '',
          username: username || '',
          donationType: donationType === 'Others' ? otherDonation : donationType,
          otherDonation: otherDonation,
          amount: amount,
          itemsDescription: itemsDescription,
          message: message || ''
        });

        Toast.show(data.message, data.success ? 'success' : 'error');
        
        if (data.success) {
          // Reset form
          document.getElementById('addRecordForm').reset();
          // Reset field visibility
          toggleOtherField();
          // Redirect to admin interface after a delay
          setTimeout(() => {
            Navigation.goTo('adminInt');
          }, CONFIG.REDIRECT_DELAY);
        }
      } catch (error) {
        Toast.error('An error occurred. Please try again.');
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      toggleOtherField();
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation Record System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="body1">
  <header class="main-header">
    <div class="logo-title">
      <img src="images/ginatilanlogo1.png" alt="Logo" class="header-logo">
      <h2>Donation Record System</h2>
    </div>
    <div class="settings-container">
      <button class="settings-btn" id="settingsBtn" onclick="toggleSettingsMenu()" title="Settings">
        <span class="settings-icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
      <div class="settings-menu" id="settingsMenu">
        <a href="#" onclick="goToAnnouncement(); return false;">Make Announcement</a>
        <a href="#" onclick="goToViewRecord(); return false;">View Record</a>
        <a href="#" onclick="goToAddRecord(); return false;">Add Record</a>
        <a href="#" onclick="goToMembers(); return false;">Members</a>
        <a href="#" onclick="handleAdminLogout(); return false;">Log Out</a>
      </div>
    </div>
  </header>

  <main class="main-container1">
    <div class="welcome-card">
      <h1 id="welc">Donation History</h1> 
      <table class="notif-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Donor Name</th>
            <th>Donation Type</th>
            <th>Amount/Item</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="donationHistoryTable">
          <!-- Donation records will be loaded here dynamically -->
        </tbody>
      </table>
      
      <button class="x-btn" onclick="goBack()">
        <img src="images/458594.png" alt="Close">
      </button>
    </div>
    
  </main>

  <script>
    // Load approved donations when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadApprovedDonations();
    });

    async function loadApprovedDonations() {
      try {
        const response = await fetch(`${CONFIG.API_BASE_URL}/donations/all`);
        const data = await response.json();
        
        if (data.success && data.donations) {
          const approvedDonations = data.donations.filter(d => d.status === 'APPROVED');
          const tableBody = document.getElementById('donationHistoryTable');
          tableBody.innerHTML = '';

          if (approvedDonations.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No approved donations yet</td></tr>';
            return;
          }

          approvedDonations.forEach(donation => {
            const row = document.createElement('tr');
            const createdAt = new Date(donation.createdAt).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });
            
            const amountOrItem = donation.donationType === 'Cash' 
              ? `â‚±${parseFloat(donation.amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
              : donation.message || donation.amount;
            
            row.innerHTML = `
              <td>${createdAt}</td>
              <td>${donation.fullName}</td>
              <td>${donation.donationType}</td>
              <td>${amountOrItem}</td>
              <td><span style="color: green; font-weight: bold;">Received</span></td>
            `;
            tableBody.appendChild(row);
          });
        }
      } catch (error) {
        console.error('Error loading donations:', error);
        document.getElementById('donationHistoryTable').innerHTML = 
          '<tr><td colspan="5" style="text-align: center; color: red;">Error loading donations</td></tr>';
      }
    }
  </script>

  <footer class="main-footer">
    <p>&copy; 2025 Donation Record System | All Rights Reserved</p>
    <p>Developed by CTU Ginatilan Students.</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
